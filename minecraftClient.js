async function downloadFileToCheerpJ(e,t,r){let s=await fetch(e),i=s.body.getReader(),a=+s.headers.get("Content-Length"),n=new Uint8Array(a);r?.(0,a);let o=0;for(;;){let{done:l,value:h}=await i.read();if(l)break;n.set(h,o),r?.(o+=h.length,a)}return new Promise((e,r)=>{var s=[];cheerpOSOpen(s,t,"w",t=>{cheerpOSWrite(s,t,n,0,n.length,r=>{cheerpOSClose(s,t,e)})})})}export default class e{#a;#b;#c;#d;#e;#f;#g;#h;#i;constructor(e,t,r){this.#c=document.querySelector("button"),this.#c.addEventListener("click",()=>this.run()),this.#b=r||document.querySelector("progress"),this.#b&&(this.#b.style.display="none"),this.#e=document.querySelector(".intro"),this.#d=document.querySelector(".display"),cheerpjCreateDisplay(-1,-1,this.#d),this.#f=!1,this.#g=e,this.#h="function"==typeof t?t:function(){},this.#i=this.#b}async run(){if(this.#f)throw Error("Already running");this.#f=!0,self.plausible&&self.plausible("Play"),this.#e.style.display="none",this.#b&&(this.#b.style.display="unset");let e="/files/client.jar";if(this.#g instanceof Blob){this.#h("Writing modded jar to CheerpJ VFS...");let t=await this.#g.arrayBuffer();await new Promise((r,s)=>{var i=[];cheerpOSOpen(i,e,"w",e=>{cheerpOSWrite(i,e,new Uint8Array(t),0,t.byteLength,t=>{cheerpOSClose(i,e,r)})})}),this.#i&&(this.#i.value=2)}else if("string"==typeof this.#g)this.#h("Downloading original jar to CheerpJ VFS..."),await downloadFileToCheerpJ(this.#g,e,(e,t)=>{this.#i&&(this.#i.value=1+e/(t||1),this.#i.max=4)});else throw this.#h("No jar source provided!"),Error("No jar source provided");if("jar"===window.versionType||"jar-zip"===window.versionType)try{await cheerpjFSDeleteTree("/files/.minecraft/mods")}catch(r){}if("jar"===window.versionType||"jar-zip"===window.versionType){try{cheerpjCreateDirectory("/files/.minecraft")}catch(s){}try{cheerpjCreateDirectory("/files/.minecraft/mods")}catch(i){}if(void 0!==window.uploadedMods&&Array.isArray(window.uploadedMods)&&window.uploadedMods.length>0)for(let a of window.uploadedMods){if(!a.name.endsWith(".jar"))continue;let n=await a.arrayBuffer();await new Promise((e,t)=>{var r=[];cheerpOSOpen(r,`/files/.minecraft/mods/${a.name}`,"w",t=>{cheerpOSWrite(r,t,new Uint8Array(n),0,n.byteLength,s=>{cheerpOSClose(r,t,e)})})})}}this.#b&&(this.#b.style.display="none"),this.#d&&(this.#d.style.display="unset");let o="net.minecraft.client.Minecraft";if(window.selectedVersionClass&&"string"==typeof window.selectedVersionClass&&(o=window.selectedVersionClass),Array.isArray(window.selectedVersionLibraries))for(let l of window.selectedVersionLibraries){if(!l.url||!l.path)continue;let h=l.path.substring(0,l.path.lastIndexOf("/"));try{cheerpjCreateDirectory(h)}catch(d){}await downloadFileToCheerpJ(l.url,l.path,(e,t)=>{console.log(`Downloading ${l.url}: ${e}/${t}`)})}let c=`${e}`;if(Array.isArray(window.selectedVersionLibraries))for(let p of window.selectedVersionLibraries)p.path&&(c=`${p.path}:${c}`);c=`${c}:/app/lwjgl-2.9.3.jar:/app/lwjgl_util-2.9.3.jar`,this.#h("Launching Minecraft from /files/client.jar ...");let u=Array.isArray(window.selectedVersionJvmArgs)?window.selectedVersionJvmArgs:[],f=await cheerpjRunMain(o,c,...u);return this.#f=!1,f}get isRunning(){return this.#f}};async function prepareLibrariesAndLaunch(e,t){let r=window.selectedVersionLibraries||[];for(let s of r){if(!s.url||!s.path)continue;let i=s.path.substring(0,s.path.lastIndexOf("/"));await cheerpjCreateDirectory(i,!0);let a=await fetch(s.url),n=await a.arrayBuffer();await cheerpOSOpen(s.path,"w").then(e=>e.write(new Uint8Array(n)).then(()=>e.close()))}let o=r.map(e=>e.path),l=[...o,e,...t].join(":"),h=window.selectedVersionJvmArgs||[],d=window.selectedVersionClass||"net.minecraft.client.Minecraft";cheerpjRunMain({classpath:l,mainClass:d,args:[],jvmArgs:h})}